!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=0)}([function(t,e,i){i(1),i(2),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(18),i(23),t.exports=i(25)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),Craft.SproutForms.EditableTable=Garnish.Base.extend({initialized:!1,id:null,baseName:null,columns:null,fieldRuleOptions:null,sorter:null,biggestId:-1,$table:null,$tbody:null,$addRowBtn:null,init:function(t,e,i,s,n){this.id=t,this.baseName=e,this.columns=i,this.fieldRuleOptions=n,this.setSettings(s,Craft.SproutForms.EditableTable.defaults),this.$table=$("#"+t),this.$tbody=this.$table.children("tbody"),this.sorter=new Craft.DataTableSorter(this.$table,{helperClass:"editabletablesorthelper",copyDraggeeInputValuesToHelper:!0}),this.isVisible()?this.initialize(this.fieldRuleOptions):this.addListener(Garnish.$win,"resize","initializeIfVisible")},isVisible:function(){return this.$table.height()>0},initialize:function(t){if(!this.initialized){this.initialized=!0,this.removeListener(Garnish.$win,"resize");for(var e=this.$tbody.children(),i=0;i<e.length;i++)new Craft.SproutForms.EditableTable.Row(this,e[i],t);this.$addRowBtn=this.$table.find(".buttons").children(".add"),this.addListener(this.$addRowBtn,"activate","addRow"),0===e.length&&this.addRow()}},initializeIfVisible:function(){this.isVisible()&&this.initialize()},addRow:function(){var t=this.settings.rowIdPrefix+(this.biggestId+1),e=Craft.SproutForms.EditableTable.getRowHtml(t,this.columns,this.baseName,{},this.fieldRuleOptions),i=$(e).appendTo(this.$tbody);new Craft.SproutForms.EditableTable.Row(this,i,this.fieldRuleOptions);i.find(".sprout-selectother");this.sorter.addItems(i),i.find("input,textarea,select").first().focus(),this.settings.onAddRow(i),this.$addRowBtn=i.find("#add-rule"),this.addListener(this.$addRowBtn,"activate","addRow")}},{textualColTypes:["singleline","multiline","number"],defaults:{rowIdPrefix:"",onAddRow:$.noop,onDeleteRow:$.noop},getRowHtml:function(t,e,i,s,n){var r='<tr data-id="'+t+'">',a="";for(var o in e){var l=e[o],d=i+"[condition-"+t+"]["+o+"]",u=void 0!==s[o]?s[o]:"",c=Craft.inArray(l.type,Craft.SproutForms.EditableTable.textualColTypes);switch("0"===o&&(d,a=""!==u?u:l.options[0].value),r+='<td class="'+(c?"textual":"")+" "+(void 0!==l.class?l.class:"")+'"'+(void 0!==l.width?' width="'+l.width+'"':"")+">",l.type){case"select":r+='<div class="select"><select name="'+d+'">';var h=!1,f="selected";for(var p in l.options){var m=l.options[p];if(void 0!==m.optgroup)h?r+="</optgroup>":h=!0,r+='<optgroup label="'+m.optgroup+'">';else{var v=void 0!==m.label?m.label:m,b=void 0!==m.value?m.value:p;r+="<option "+f+' value="'+b+'"'+(b===u?" selected":"")+(void 0!==m.disabled&&m.disabled?" disabled":"")+">"+v+"</option>"}f=""}h&&(r+="</optgroup>"),r+="</select></div>";break;case"selectCondition":d;var g=void 0!==l.options[0]?l.options[0].value:"";""!==u?u:g,r+='<div class="select"><select data-check-value-html="true" name="'+d+'">',l.options=n[a].conditionsAsOptions;var $=!1,y="selected";for(var C in l.options){var S=l.options[C];if(void 0!==S.optgroup)$?r+="</optgroup>":$=!0,r+='<optgroup label="'+S.optgroup+'">';else{var T=void 0!==S.label?S.label:S,x=void 0!==S.value?S.value:C;r+="<option "+y+' value="'+x+'"'+(x===u?" selected":"")+(void 0!==S.disabled&&S.disabled?" disabled":"")+">"+T+"</option>"}y=""}$&&(r+="</optgroup>"),r+="</select></div>";break;case"checkbox":r+='<input type="hidden" name="'+d+'"><input type="checkbox" name="'+d+'" value="1"'+(u?" checked":"")+">";break;default:r+='<input class="text fullwidth" type="text" name="'+d+'" value="'+u+'">'}r+="</td>"}return r+='<td class="thin action"><div class="buttons"> <div id="add-rule" class="btn add icon small" tabindex="0">OR</div> </div></td><td class="thin action"><a class="delete icon" title="'+Craft.t("sprout-seo","Delete")+'"></a></td></tr>'}}),Craft.SproutForms.EditableTable.Row=Garnish.Base.extend({table:null,id:null,niceTexts:null,$tr:null,$tds:null,$textareas:null,$deleteBtn:null,fieldRuleOptions:null,init:function(t,e,i){this.table=t,this.$tr=$(e),this.$tds=this.$tr.children(),this.fieldRuleOptions=i;var s=parseInt(this.$tr.attr("data-id").substr(this.table.settings.rowIdPrefix.length));s>this.table.biggestId&&(this.table.biggestId=s),this.$textareas=$(),this.niceTexts=[];var n={},r=this,a=0;for(var o in this.table.columns){var l=this.table.columns[o];if(Craft.inArray(l.type,Craft.SproutForms.EditableTable.textualColTypes)){var d=$("textarea",this.$tds[a]);this.$textareas=this.$textareas.add(d),this.addListener(d,"focus","onTextareaFocus"),this.addListener(d,"mousedown","ignoreNextTextareaFocus"),this.niceTexts.push(new Garnish.NiceText(d,{onHeightChange:$.proxy(this,"onTextareaHeightChange")})),"singleline"!==l.type&&"number"!==l.type||(this.addListener(d,"keypress",{type:l.type},"validateKeypress"),this.addListener(d,"textchange",{type:l.type},"validateValue")),n[o]=d}a++}for(var u in this.initSproutFields(),this.onTextareaHeightChange(),this.table.columns){var c=this.table.columns[u];c.autopopulate&&void 0!==n[c.autopopulate]&&!n[u].val()&&new Craft.HandleGenerator(n[u],n[c.autopopulate])}var h=this.$tr.find("td:eq(1)").find("select").data("check-value-html"),f=this.$tr.find("td:eq(0)").find("select"),p=this.$tr.find("td:eq(1)").find("select");f.change({row:this},(function(t){var e="";e+='<div class="select"><select data-check-value-html="true" name="'+name+'">';var i={};i.options=r.fieldRuleOptions[f.val()].conditionsAsOptions;var s=p.val(),n=!1,a="selected";for(var o in i.options){var l=i.options[o];if(void 0!==l.optgroup)n?e+="</optgroup>":n=!0,e+='<optgroup label="'+l.optgroup+'">';else{var d=void 0!==l.label?l.label:l,u=void 0!==l.value?l.value:o;e+="<option "+a+' value="'+u+'"'+(u===s?" selected":"")+(void 0!==l.disabled&&l.disabled?" disabled":"")+">"+d+"</option>"}a=""}n&&(e+="</optgroup>"),e+="</select></div>",p.html(e),r.addValueInputHtml(r)})),p.change({row:this},(function(t){r.addValueInputHtml(r)})),!0===h&&this.addValueInputHtml();var m=this.$tr.children().last().find(".delete");this.addListener(m,"click","deleteRow")},addValueInputHtml:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=null==t?this:t,i=0===this.$tr.find("td:eq(2)").find("input").length?this.$tr.find("td:eq(2)").find("select"):this.$tr.find("td:eq(2)").find("input"),s={formFieldHandle:this.$tr.find("td:eq(0)").find("select").val(),condition:this.$tr.find("td:eq(1)").find("select").val(),inputName:i.attr("name"),inputValue:i.val(),formId:$("#formId").val()};Craft.postActionRequest("sprout-forms/rules/get-condition-value-input-html",s,$.proxy((function(t,i){"success"===i&&t.success?e.$tr.find("td:eq(2)").html(t.html):Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the input html"))}),this))},initSproutFields:function(){Craft.SproutFields.initFields(this.$tr)},onTextareaFocus:function(t){this.onTextareaHeightChange();var e=$(t.currentTarget);e.data("ignoreNextFocus")?e.data("ignoreNextFocus",!1):setTimeout((function(){var t=e.val();if(void 0!==e[0].setSelectionRange){var i=2*t.length;e[0].setSelectionRange(0,i)}else e.val(t)}),0)},ignoreNextTextareaFocus:function(t){$.data(t.currentTarget,"ignoreNextFocus",!0)},validateKeypress:function(t){var e=t.keyCode?t.keyCode:t.charCode;Garnish.isCtrlKeyPressed(t)||e!==Garnish.RETURN_KEY&&("number"!==t.data.type||Craft.inArray(e,Craft.SproutForms.EditableTable.Row.numericKeyCodes))||t.preventDefault()},validateValue:function(t){var e;if("number"===t.data.type){var i=t.currentTarget.value.match(/^\s*(-?[\d\.]*)/);e=null!==i?i[1]:""}else e=t.currentTarget.value.replace(/[\r\n]/g,"");e!==t.currentTarget.value&&(t.currentTarget.value=e)},onTextareaHeightChange:function(){for(var t=-1,e=0;e<this.niceTexts.length;e++)this.niceTexts[e].height>t&&(t=this.niceTexts[e].height);this.$textareas.css("min-height",t);var i=this.$textareas.first().parent().height();i>t&&this.$textareas.css("min-height",i)},deleteRow:function(){if(this.table.sorter.removeItems(this.$tr),this.$tr.remove(),1===this.table.$table.find("tr").length){var t=this.table.$table.prev(".rules-table-and");1===t.length&&t.remove(),this.table.$table.remove()}this.table.settings.onDeleteRow(this.$tr)}},{numericKeyCodes:[9,8,37,38,39,40,45,91,46,190,48,49,50,51,52,53,54,55,56,57]})},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){Craft.SproutForms.FormSettings=Garnish.Base.extend({options:null,modal:null,ruleModal:null,$lightswitches:null,init:function(){this.initButtons()},initButtons:function(){var e=this;t("a[id^='sproutform-integration']").each((function(i,s){var n=t(s).data("integrationid");n&&e.addListener(t("#sproutform-integration-"+n),"activate","editIntegration")})),t("a[id^='sproutform-rules']").each((function(i,s){var n=t(s).data("ruleId");n&&e.addListener(t("#sproutform-rules-"+n),"activate","editRule")})),this.$lightswitches=t(".sproutforms-integration-row .lightswitch"),this.addListener(this.$lightswitches,"click","onEnableIntegration"),this.$ruleEnabledLightswitches=t(".sproutforms-rules-row .lightswitch"),this.addListener(this.$ruleEnabledLightswitches,"click","onEnableRule"),this.modal=Craft.SproutForms.IntegrationModal.getInstance(),this.modal.on("saveIntegration",t.proxy((function(t){var e=t.integration;this.resetIntegration(e)}),this)),this.ruleModal=Craft.SproutForms.RuleModal.getInstance(),this.ruleModal.on("saveRule",t.proxy((function(t){var e=t.rule;this.resetConditional(e)}),this)),this.addListener(t("#integrationsOptions"),"change","createDefaultIntegration"),this.addListener(t("#ruleOptions"),"change","createDefaultRule")},onEnableIntegration:function(e){var i=e.currentTarget,s=i.id,n=t(i).attr("aria-checked"),r={integrationId:s,enabled:n="true"===n?1:0,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/integrations/enable-integration",r,t.proxy((function(t,e){"success"===e&&t.success?Craft.cp.displayNotice(Craft.t("sprout-forms","Integration updated.")):Craft.cp.displayError(Craft.t("sprout-forms","Unable to update integration"))}),this))},onEnableRule:function(e){var i=e.currentTarget,s=i.id,n=t(i).attr("aria-checked"),r={ruleId:s,enabled:n="true"===n?1:0,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/rules/enable-rule",r,t.proxy((function(t,e){"success"===e&&t.success?Craft.cp.displayNotice(Craft.t("sprout-forms","Conditional updated.")):Craft.cp.displayError(Craft.t("sprout-forms","Unable to update conditional"))}),this))},resetIntegration:function(e){var i=t("#sproutform-integration-"+e.id),s=t("#integration-enabled-"+e.id),n="1"===e.enabled;n!==("true"===s.attr("aria-checked"))&&(s.attr("aria-checked",""+n),n?s.addClass("on"):s.removeClass("on")),i.html(e.name)},resetConditional:function(e){var i=t("#sproutform-rules-"+e.id),s=t("#condition-enabled-"+e.id),n=t("#sproutform-rules-behavior-"+e.id),r="1"===e.enabled;r!==("true"===s.attr("aria-checked"))&&(s.attr("aria-checked",""+r),r?s.addClass("on"):s.removeClass("on")),n.html(e.behavior),i.html(e.name)},createDefaultIntegration:function(e){var i=this,s=t("#sproutforms-integrations-table tbody"),n=t("#integrationsOptions").val(),r=t("#formId").val();if(""!==n){var a={type:n,formId:r,sendRule:"*"};Craft.postActionRequest("sprout-forms/integrations/save-integration",a,t.proxy((function(e,n){if("success"===n){var r=e.integration;s.append('<tr class="field sproutforms-integration-row" id ="sproutforms-integration-row-'+r.id+'"><td class="heading"><a href="#" id ="sproutform-integration-'+r.id+'" data-integrationid="'+r.id+'">'+r.name+'</a></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="integration-enabled-'+r.id+'"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="" value=""></div></td></tr>'),i.addListener(t("#sproutform-integration-"+r.id),"activate","editIntegration"),t("#integrationsOptions").val("");var a=t("#integration-enabled-"+r.id);a.lightswitch(),i.addListener(a,"click","onEnableIntegration")}}),this))}},createDefaultRule:function(e){var i=this,s=t("#sproutforms-rules-table tbody"),n=t("#ruleOptions").val(),r=t("#formId").val();if(""!==n){var a={type:n,formId:r};Craft.postActionRequest("sprout-forms/rules/save-rule",a,t.proxy((function(e,n){if("success"===n){var r=e.rule;s.append('<tr id ="sproutforms-rules-row-'+r.id+'" class="field sproutforms-rules-row"><td><a href="#" id ="sproutform-rules-'+r.id+'" data-rule-id="'+r.id+'">'+r.name+'</a></td><td><div id ="sproutform-rules-behavior-'+r.id+'">'+r.behavior+'</div></td><td><div class="lightswitch small" tabindex="0" data-value="1" role="checkbox" aria-checked="false" id ="condition-enabled-'+r.id+'"><div class="lightswitch-container"><div class="label on"></div><div class="handle"></div><div class="label off"></div></div><input type="hidden" name="" value=""></div></td></tr>'),i.addListener(t("#sproutform-rules-"+r.id),"activate","editRule"),t("#ruleOptions").val("");var a=t("#condition-enabled-"+r.id);a.lightswitch(),i.addListener(a,"click","onEnableRule")}}),this))}},editRule:function(e){var i=e.currentTarget,s=t(i).data("ruleId");this.base(t(i)),this.ruleModal.editRule(s)},editIntegration:function(e){var i=e.currentTarget,s=t(i).data("integrationid");this.base(t(i)),this.modal.editIntegration(s)}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),Craft.SproutForms.EntriesIndex=Craft.BaseElementIndex.extend({getViewClass:function(t){return"table"===t?Craft.SproutForms.EntriesTableView:this.base(t)},getDefaultSort:function(){return["dateCreated","desc"]}}),Craft.registerElementIndexClass("barrelstrength\\sproutforms\\elements\\Entry",Craft.SproutForms.EntriesIndex)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),Craft.SproutForms.EntriesTableView=Craft.TableElementIndexView.extend({startDate:null,endDate:null,startDatepicker:null,endDatepicker:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,$startDate:null,$endDate:null,afterInit:function(){this.$explorerContainer=$('<div class="chart-explorer-container"></div>').prependTo(this.$container),this.createChartExplorer(),this.base()},getStorage:function(t){return Craft.SproutForms.EntriesTableView.getStorage(this.elementIndex._namespace,t)},setStorage:function(t,e){Craft.SproutForms.EntriesTableView.setStorage(this.elementIndex._namespace,t,e)},createChartExplorer:function(){var t=$('<div class="chart-explorer"></div>').appendTo(this.$explorerContainer),e=$('<div class="chart-header"></div>').appendTo(t),i=$('<div class="date-range" />').appendTo(e),s=$('<div class="datewrapper"></div>').appendTo(i),n=($('<span class="to light">to</span>').appendTo(i),$('<div class="datewrapper"></div>').appendTo(i)),r=$('<div class="total"></div>').appendTo(e),a=($('<div class="total-label light">'+Craft.t("sprout-forms","Total Submissions")+"</div>").appendTo(r),$('<div class="total-value-wrapper"></div>').appendTo(r)),o=$('<span class="total-value">&nbsp;</span>').appendTo(a);this.$chartExplorer=t,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(t),this.$spinner=$('<div class="spinner hidden" />').prependTo(e),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$startDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(s),this.$endDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(n),this.$startDate.datepicker($.extend({onSelect:$.proxy(this,"handleStartDateChange")},Craft.datepickerOptions)),this.$endDate.datepicker($.extend({onSelect:$.proxy(this,"handleEndDateChange")},Craft.datepickerOptions)),this.startDatepicker=this.$startDate.data("datepicker"),this.endDatepicker=this.$endDate.data("datepicker"),this.addListener(this.$startDate,"keyup","handleStartDateChange"),this.addListener(this.$endDate,"keyup","handleEndDateChange");var l=this.getStorage("startTime")||(new Date).getTime()-2592e6,d=this.getStorage("endTime")||(new Date).getTime();this.setStartDate(new Date(l)),this.setEndDate(new Date(d)),this.loadReport()},handleStartDateChange:function(){this.setStartDate(Craft.SproutForms.EntriesTableView.getDateFromDatepickerInstance(this.startDatepicker))&&this.loadReport()},handleEndDateChange:function(){this.setEndDate(Craft.SproutForms.EntriesTableView.getDateFromDatepickerInstance(this.endDatepicker))&&this.loadReport()},setStartDate:function(t){return(!this.startDate||t.getTime()!==this.startDate.getTime())&&(this.startDate=t,this.setStorage("startTime",this.startDate.getTime()),this.$startDate.val(Craft.formatDate(this.startDate)),this.endDate&&this.startDate.getTime()>this.endDate.getTime()&&this.setEndDate(new Date(this.startDate.getTime())),!0)},setEndDate:function(t){return(!this.endDate||t.getTime()!==this.endDate.getTime())&&(this.endDate=t,this.setStorage("endTime",this.endDate.getTime()),this.$endDate.val(Craft.formatDate(this.endDate)),this.startDate&&this.endDate.getTime()<this.startDate.getTime()&&this.setStartDate(new Date(this.endDate.getTime())),!0)},loadReport:function(){var t=this.settings.params;t.startDate=Craft.SproutForms.EntriesTableView.getDateValue(this.startDate),t.endDate=Craft.SproutForms.EntriesTableView.getDateValue(this.endDate),this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("sprout-forms/charts/get-entries-data",t,$.proxy((function(t,e){if(this.$spinner.addClass("hidden"),"success"===e&&void 0===t.error){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var i=new Craft.charts.DataTable(t.dataTable),s={localeDefinition:t.localeDefinition,orientation:t.orientation,formats:t.formats,dataScale:t.scale};this.chart.draw(i,s),this.$totalValue.html(t.totalHtml)}else{var n=Craft.t("sprout-forms","An unknown error occurred.");void 0!==t&&t&&void 0!==t.error&&(n=t.error),this.$error.html(n),this.$error.removeClass("hidden"),this.$chart.addClass("error")}}),this))}},{storage:{},getStorage:function(t,e){return Craft.SproutForms.EntriesTableView.storage[t]&&Craft.SproutForms.EntriesTableView.storage[t][e]?Craft.SproutForms.EntriesTableView.storage[t][e]:null},setStorage:function(t,e,i){"undefined"===s(Craft.SproutForms.EntriesTableView.storage[t])&&(Craft.SproutForms.EntriesTableView.storage[t]={}),Craft.SproutForms.EntriesTableView.storage[t][e]=i},getDateFromDatepickerInstance:function(t){return new Date(t.currentYear,t.currentMonth,t.currentDay)},getDateValue:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}})},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){Craft.SproutForms.FieldLayoutEditor=Garnish.Base.extend({$container:null,$groupButton:null,$fieldButton:null,$settings:null,fld:null,modal:null,formLayout:null,fieldsLayout:null,wheelHtml:null,continueEditing:null,drake:null,drakeTabs:null,tabsLayout:null,$saveFormButton:null,init:function(e,i){var s=this;this.$saveFormButton=t("#save-form-button"),this.continueEditing=i,this.initButtons(),this.initTabSettings(),this.wheelHtml=' <span class="settings icon icon-wheel"></span>',this.modal=Craft.SproutForms.FieldModal.getInstance(),this.modal.on("newField",t.proxy((function(t){var e=t.field,i=e.group;this.addField(e.id,e.name,i.name)}),this)),this.modal.on("saveField",t.proxy((function(t){var e=t.field,i=e.group;this.resetField(e,i)}),this)),this.tabsLayout=this.getId("sprout-forms-tabs"),this.drakeTabs=dragula([this.tabsLayout],{accepts:function(e,i,s,n){return null===n||t(e).is(".drag-tab")},invalid:function(t,e){return t.classList.contains("donotdrag")}}).on("drag",(function(e){t(e).addClass("drag-tab-active")})).on("drop",(function(e,i,s){t(e).removeClass("drag-tab-active"),t(i).find(".drag-tab-active").removeClass("drag-tab-active"),t(s).find(".drag-tab-active").removeClass("drag-tab-active"),t(i).attr("id")===t(s).attr("id")&&t("#sprout-forms-tabs li.drag-tab a").each((function(e){var i=t(this).attr("id"),s=t("#sproutforms-fieldlayout-container");if(i){var n=t("#sproutforms-"+i);n&&s.append(n)}}))})),this.fieldsLayout=this.getId("right-copy"),this.drake=dragula([null,this.fieldsLayout],{copy:function(t,e){return e===s.fieldsLayout},accepts:function(t,e){return e!==s.fieldsLayout},invalid:function(t,e){return t.classList.contains("donotdrag")}}).on("drag",(function(e){t(e).addClass("drag-active")})).on("drop",(function(e,i,n){if(t(e).removeClass("drag-active"),t(i).find(".drag-active").removeClass("drag-active"),t(n).find(".drag-active").removeClass("drag-active"),t(i).attr("id"),t(n).attr("id"),i&&n===s.fieldsLayout){var r=t(e).closest(".sproutforms-tab-fields"),a=r.data("tabname"),o=r.data("tabid"),l=t(e).data("type");s.createDefaultField(l,o,a,e)}})).on("over",(function(e,i){t(e).addClass("drag-active"),t(i).addClass("container-active")})).on("out",(function(e,i){t(e).removeClass("drag-active"),t(i).removeClass("container-active")}));autoScroll([document.querySelector("#content-container")],{margin:20,maxSpeed:10,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.drake.dragging}}),autoScroll([document.querySelector("#sprout-forms-tabs")],{margin:20,maxSpeed:10,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.drakeTabs.dragging}});for(var n=0;n<e.length;n++)this.drake.containers.push(this.getId("sproutforms-tab-container-"+e[n].id))},clickHandler:function(t){var e=t.target;e!==this.tabsLayout&&(e.innerHTML+=" [click!]",setTimeout((function(){e.innerHTML=e.innerHTML.replace(/ \[click!]/g,"")}),500))},createDefaultField:function(e,i,s,n){t(n).removeClass("source-field"),t(n).addClass("target-field"),t(n).find(".source-field-header").remove(),t(n).find(".body").removeClass("hidden");var r=t(n).next(".target-field"),a=r.attr("id");if(null==a)r=null;else{var o=a.split("-");a=o[1]}var l=t(n).data("defaultname")?t(n).data("defaultname"):Craft.t("sprout-forms","Untitled");t(n).prepend(t(['<div class="active-field-header">',"<h2>",l,"</h2>","</div>"].join("")));var d={type:e,formId:t("#formId").val(),tabId:i,nextId:a};Craft.postActionRequest("sprout-forms/fields/create-field",d,t.proxy((function(t,e){"success"===e&&this.initFieldOnDrop(t.field,s,n)}),this))},initFieldOnDrop:function(e,i,s){null!==e&&e.hasOwnProperty("id")?(t(s).attr("id","sproutfield-"+e.id),t(s).prepend(t(['<ul class="settings">','<li><a id="sproutform-field-',e.id,'" data-fieldid="',e.id,'" href="#" tabindex="0" ><i class="fa fa-pencil fa-2x" title="',Craft.t("sprout-forms","Edit"),'"></i></a></li>',"</ul>"].join(""))),t(s).append(t(['<input type="hidden" name="fieldLayout[',i,'][]" value="',e.id,'" class="id-input">'].join(""))),this.addListener(t("#sproutform-field-"+e.id),"activate","editField")):(Craft.cp.displayError(Craft.t("sprout-forms","Something went wrong when creating the field :(")),t(s).remove())},getId:function(t){return document.getElementById(t)},initTabSettings:function(){var e=this;t("#sprout-forms-tabs li").each((function(i,s){var n=t(s).find("a").attr("id"),r=t(s).find(".settings");e.initializeWheel(r,n)}))},initializeWheel:function(e,i){var s=t('<div class="menu" data-align="center"/>').insertAfter(e),n=t("<ul/>").appendTo(s);t('<li><a data-action="add" data-tab-id="'+i+'">'+Craft.t("sprout-forms","Add Tab")+"</a></li>").appendTo(n),t('<li><a data-action="rename" data-tab-id="'+i+'">'+Craft.t("sprout-forms","Rename")+"</a></li>").appendTo(n),t('<li><a id ="#delete-'+i+'" data-action="delete" data-tab-id="'+i+'">'+Craft.t("sprout-forms","Delete")+"</a></li>").appendTo(n),new Garnish.MenuBtn(e,{onOptionSelect:t.proxy(this,"onTabOptionSelect")})},onTabOptionSelect:function(e){var i=t(e),s=i.data("tab-id");switch(i.data("action")){case"add":this.addNewTab();break;case"rename":this.renameTab(s);break;case"delete":this.deleteTab(s)}},initButtons:function(){var e=this;t("a[id^='sproutform-field-']").each((function(i,s){var n=t(s).data("fieldid");n&&e.addListener(t("#sproutform-field-"+n),"activate","editField")})),t("a[id^='delete-tab-']").each((function(i,s){var n=t(s).data("tabid");n&&e.addListener(t("#delete-tab-"+n),"activate","deleteTab")}))},deleteTab:function(e){if(this.confirmDeleteTab()){var i={tabId:e};Craft.postActionRequest("sprout-forms/fields/delete-tab",i,t.proxy((function(i,s){i.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Tab Deleted")),t("#sproutforms-"+e).slideUp(500,(function(){t(this).remove()})),t("#"+e).closest("li").slideUp(500,(function(){t(this).remove()}))):Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete the tab"))}),this))}},renameTab:function(e){var i=t("#"+e+" .tab-label"),s=i.text().trim(),n=prompt(Craft.t("sprout-forms","Give your tab a name."),s),r=!0,a=t(".drag-tab"),o=t("#formId").val();if(n&&n!==s)if(a.each((function(e,i){if(t(i).find(".tab-label").text()===n)return r=!1,!1})),r&&n&&o){var l={name:n,oldName:s,formId:o};Craft.postActionRequest("sprout-forms/fields/rename-tab",l,t.proxy((function(r,a){r.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Tab renamed")),t("[name^='fieldLayout["+s+"]']").each((function(e,r){var a=t(r).attr("name").replace(s,n);t(r).attr("name",a),i.text(n)})),t("#sproutforms-"+e).attr("data-tabname",n)):Craft.cp.displayError(Craft.t("sprout-forms","Unable to rename tab"))}),this))}else Craft.cp.displayError(Craft.t("sprout-forms","Invalid tab name"))},addNewTab:function(){var e=this.promptForGroupName(""),i=!0,s=t(".drag-tab"),n=t("#formId").val(),r=this;if(s.each((function(s,n){var r=t(n).find(".tab-label").text();if(r&&r===e)return i=!1,!1})),i&&e&&n){var a={name:e,sortOrder:s.length,formId:n};Craft.postActionRequest("sprout-forms/fields/add-tab",a,t.proxy((function(e,i){if(e.success){var s=e.tab;Craft.cp.displayNotice(Craft.t("sprout-forms","Tab: "+s.name+" created"));var n="#sproutforms-tab-"+s.id;t("#sprout-forms-tabs").append('<li class="drag-tab"><a id="tab-'+s.id+'" class="tab" href="'+n+'" tabindex="0"><span class="tab-label">'+s.name+"</span>&nbsp;"+this.wheelHtml+"</a></li>");var a=t("#tab-"+s.id).find(".settings");r.initializeWheel(a,"tab-"+s.id),t("#sproutforms-fieldlayout-container").append(t(['<div id="sproutforms-tab-'+s.id+'" data-tabname="'+s.name+'" data-tabid="'+s.id+'" class="sproutforms-tab-fields hidden">','<div class="parent">','<div id="sproutforms-tab-container-'+s.id+'" class="sprout-tab-container">',"</div>","</div>","</div>"].join(""))),this.drake.containers.push(this.getId("sproutforms-tab-container-"+s.id)),Craft.cp.initTabs()}else Craft.cp.displayError(Craft.t("sprout-forms","Unable to create a new tab"))}),this))}else Craft.cp.displayError(Craft.t("sprout-forms","Invalid tab name"))},promptForGroupName:function(t){return prompt(Craft.t("sprout-forms","What do you want to name your new tab?"),t)},confirmDeleteTab:function(){return confirm("Are you sure you want to delete this tab, all of it's fields, and all of it's data?")},newField:function(){this.modal.show()},editField:function(e){var i=e.currentTarget,s=t(i).data("fieldid");this.$field=t(i),this.base(t(i)),this.modal.editField(s)},resetField:function(e,i){var s=t("#sproutfield-"+e.id);t(s).find(".body").html(e.htmlExample);var n=t(s).find("[name='requiredFields[]']");e.required?(t(s).find(".active-field-header h2").addClass("required"),n.length?t(n).val(e.id):t('<input type="hidden" name="requiredFields[]" value="'+e.id+'" class="sproutforms-required-input">').appendTo(s)):(t(s).find(".active-field-header h2").removeClass("required"),t(n).val("")),t(s).find(".active-field-header h2").html(e.name),t(s).find(".active-field-header p").html(e.instructions);var r=t(s).closest(".sproutforms-tab-fields"),a=r.data("tabname");r.data("tabid");if(a!==i.name){t(s).find(".id-input").remove();t(['<input class="id-input" type="hidden" name="fieldLayout[',i.name,'][]" value="',e.id,'">'].join("")).appendTo(t(s));var o=t("#sproutforms-tab-container-"+i.id);t(s).detach().appendTo(t(o))}}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.FieldModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(i){this.base(),this.setSettings(i,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var s=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(s),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(s),this.$loadSpinner=t('<div class="spinner big">').appendTo(s),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(s);var n={formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/fields/modal-field",n,t.proxy((function(t,e){"success"===e?(this.$loadSpinner.addClass("hidden"),this.initTemplate(t)):this.destroy()}),this))},initTemplate:function(e){var i=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)}),this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){var i=this,s=Garnish.$doc.find("head"),n=t(e.html),r=t(e.js).filter("script"),a=t(e.css).filter("style, link"),o=a.filter("link").prop("async",!0),l=a.filter("style");o.each((function(){var e=t(this),n=e.prop("href");i.loadedCss.hasOwnProperty(n)||(s.append(e),i.loadedCss[n]=e)}));var d=r.filter("[src]"),u=r.filter(":not([src])"),c=[];d.each((function(){var e=t(this).prop("src");i.executedJs.hasOwnProperty(e)||(c.push(e),i.executedJs[e]=!0)}));t.when(this.runExternalScripts(c)).then(function t(){i.off("runExternalScripts",t),i.trigger("parseTemplate",{target:this,$html:n,$js:u,$css:l})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var i=e.length;if(i>0)for(var s=0;s<e.length;s++){var n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&t.getScript(n,t.proxy((function(t,e){"success"===e?0===--i&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveField"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteField"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var i=e&&e.target?e.target:this;if(i.templateLoaded){i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=t(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs);i.$main.find('input[name="fieldId"]');Craft.initUiElements();t.when(i.runExternalScripts(Object.keys(i.executedJs))).then(function t(){i.off("runExternalScripts",t),setTimeout((function(){i.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveField:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var i=this.$container.serialize(),s=this.$container.find('input[name="fieldId"]'),n=!!s.length&&s.val();Craft.postActionRequest("sprout-forms/fields/save-field",i,t.proxy((function(e,i){this.$saveSpinner.addClass("hidden");var s="success"===i;if(s&&e.success)this.initListeners(),!1===n?this.trigger("newField",{target:this,field:e.field}):(this.trigger("saveField",{target:this,field:e.field}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' field saved.",{name:e.field.name}))),this.hide();else if(s&&e.template)if(this.visible){var r=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",r)}),this);this.on("parseTemplate",r),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editField:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var i={fieldId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/fields/edit-field",i,t.proxy((function(e,i){this.$loadSpinner.addClass("hidden");var s="success"===i;if(s&&e.success){var n=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template)}else s&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteField:function(e){if(e.preventDefault(),this.confirmDeleteField()){this.destroyListeners();var i=this.$container.serialize(),s=t(this.$container).find('input[name="fieldId"]').val();Craft.postActionRequest("sprout-forms/fields/delete-field",i,t.proxy((function(e,i){"success"===i&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Field deleted.")),t("#sproutfield-"+s).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete field.")),this.hide())}),this))}},confirmDeleteField:function(){return confirm("Are you sure you want to delete this field and all of it's data?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.FieldModal),this._instance}})}(jQuery)},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.IntegrationModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(i){this.base(),this.setSettings(i,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var s=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(s),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(s),this.$loadSpinner=t('<div class="spinner big">').appendTo(s),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(s),this.$loadSpinner.addClass("hidden");this.initTemplate({html:"",js:"",css:""})},initTemplate:function(e){var i=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)}),this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){var i=this,s=Garnish.$doc.find("head"),n=t(e.html),r=t(e.js).filter("script"),a=t(e.css).filter("style, link"),o=a.filter("link").prop("async",!0),l=a.filter("style");o.each((function(){var e=t(this),n=e.prop("href");i.loadedCss.hasOwnProperty(n)||(s.append(e),i.loadedCss[n]=e)}));var d=r.filter("[src]"),u=r.filter(":not([src])"),c=[];d.each((function(){var e=t(this).prop("src");i.executedJs.hasOwnProperty(e)||(c.push(e),i.executedJs[e]=!0)}));t.when(this.runExternalScripts(c)).then(function t(){i.off("runExternalScripts",t),i.trigger("parseTemplate",{target:this,$html:n,$js:u,$css:l})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var i=e.length;if(i>0)for(var s=0;s<e.length;s++){var n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&t.getScript(n,t.proxy((function(t,e){"success"===e?0===--i&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveIntegration"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteIntegration"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var i=e&&e.target?e.target:this;if(i.templateLoaded){i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=t(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs),Craft.initUiElements();t.when(i.runExternalScripts(Object.keys(i.executedJs))).then(function t(){i.off("runExternalScripts",t),setTimeout((function(){i.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveIntegration:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var i=this.$container.serialize(),s=this.$container.find('input[name="integrationId"]');!!s.length&&s.val();Craft.postActionRequest("sprout-forms/integrations/save-integration",i,t.proxy((function(e,i){this.$saveSpinner.addClass("hidden");var s="success"===i;if(s&&e.success)this.initListeners(),this.trigger("saveIntegration",{target:this,integration:e.integration}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' integration saved.",{name:e.integration.name})),this.hide();else if(s&&e.template)if(this.visible){var n=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editIntegration:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var i={integrationId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/integrations/edit-integration",i,t.proxy((function(e,i){this.$loadSpinner.addClass("hidden");var s="success"===i;if(s&&e.success){var n=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template)}else s&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteIntegration:function(e){if(e.preventDefault(),this.confirmDeleteIntegration()){this.destroyListeners();var i=this.$container.serialize(),s=t(this.$container).find('input[name="integrationId"]').val();Craft.postActionRequest("sprout-forms/integrations/delete-integration",i,t.proxy((function(e,i){"success"===i&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Integration deleted.")),t("#sproutforms-integration-row-"+s).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete integration.")),this.hide())}),this))}},confirmDeleteIntegration:function(){return confirm("Are you sure you want to delete this integration and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.IntegrationModal),this._instance}})}(jQuery)},function(t,e){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=this;this.integrationType=void 0!==e.integrationType?e.integrationType:"",this.disableOptions(),this.updateAllFieldSelects(),this.updateTargetFieldsOnChange=void 0!==e.updateTargetFieldsOnChange?e.updateTargetFieldsOnChange:[],this.updateTargetFieldsOnChange.forEach((function(t){$(t).change((function(){i.updateAllFieldSelects()}))}))}var e,n,r;return e=t,(n=[{key:"disableOptions",value:function(){var t=this,e={integrationId:$("#integrationId").val()};return Craft.postActionRequest("sprout-forms/integrations/get-source-form-fields",e,$.proxy((function(e,i){if("success"===i&&e.success){var s=e.sourceFormFields;$("tbody .formField").each((function(e){var i=$(this);i.empty();var n=s[e].label,r=s[e].value;i.append('<div style="display:none;"><select readonly name="settings['+t.integrationType+"][fieldMapping]["+e+'][sourceFormField]"><option selected value="'+r+'">'+n+'</option></select></div><div style="padding: 7px 10px;font-size: 12px;color:#8f98a3;">'+n+' <span class="code">('+r+")</span></div>")}))}else Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the Form fields"))}),this)),null}},{key:"updateAllFieldSelects",value:function(){var t="table#settings-"+this.integrationType.replace(/\\/g,"-")+"-fieldMapping tr";$(t).find("td:eq(2),th:eq(2)").remove(),$(t).find("td:eq(0),th:eq(0)").css("width","50%"),$(t).find("td:eq(1),th:eq(1)").css("width","50%");var e=this.getCurrentRows("tbody .targetFields"),i=$("#integrationId").closest("form").serialize(),s=this;Craft.postActionRequest("sprout-forms/integrations/get-target-integration-fields",i,$.proxy((function(t,i){if("success"===i&&t.success){var n=t.targetIntegrationFields;if(0===n.length)return!1;e.each((function(t){var e=$(this).find("select"),i=n[t];s.appendFieldsToSelect(e,i)}))}else Craft.cp.displayError(Craft.t("sprout-forms","Unable to get the Form fields"))}),this))}},{key:"getCurrentRows",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===t&&(t="tbody .formField"),$(t)}},{key:"appendFieldsToSelect",value:function(t,e){t.empty();var s="",n=!1;for(t.append('<option value="">'+Craft.t("sprout-forms","None")+"</option>"),i=0;i<e.length;i++){var r=e[i],a="",o=i===e.length-1;"optgroup"in r||("selected"in r&&(a="selected"),s+="<option "+a+' value="'+r.value+'">'+r.label+"</option>"),("optgroup"in r&&n||o&&n)&&(s+="</optgroup>",n=!1),"optgroup"in r&&(s+='<optgroup label="'+r.optgroup+'">',n=!0)}t.append(s)}}])&&s(e.prototype,n),r&&s(e,r),t}();window.SproutFormsIntegration=n},function(t,e,i){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}"undefined"===s(Craft.SproutForms)&&(Craft.SproutForms={}),function(t){var e=window.MutationObserver||window.WebKitMutationObserver;e||((e=function(){}).prototype.observe=function(){},e.prototype.disconnect=function(){}),Craft.SproutForms.RuleModal=Garnish.Modal.extend({$body:null,$content:null,$main:null,$footer:null,$leftButtons:null,$rightButtons:null,$saveBtn:null,$cancelBtn:null,$deleteBtn:null,$saveSpinner:null,$deleteSpinner:null,$loadSpinner:null,addedDelete:!1,$html:null,$js:null,$css:null,$currentHtml:null,$currentJs:null,$currentCss:null,$observed:null,observer:null,templateLoaded:!1,executedJs:null,loadedCss:null,init:function(i){this.base(),this.setSettings(i,{resizable:!0}),this.$currentHtml=t(),this.$currentJs=t(),this.$currentCss=t(),this.$observed=t(),this.executedJs={},this.loadedCss={},this.observer=new e(t.proxy((function(t){for(var e=0;e<t.length;e++)this.$observed=this.$observed.add(t[e].addedNodes)}),this));var s=t('<form class="modal sprout-field-modal" style="display: none; opacity: 0;">').appendTo(Garnish.$bod);this.$body=t('<div class="body">').appendTo(s),this.$content=t('<div class="content">').appendTo(this.$body),this.$main=t('<div class="main">').appendTo(this.$content),this.$footer=t('<div class="footer">').appendTo(s),this.$loadSpinner=t('<div class="spinner big">').appendTo(s),this.$leftButtons=t('<div class="buttons left">').appendTo(this.$footer),this.$rightButtons=t('<div class="buttons right">').appendTo(this.$footer),this.$deleteSpinner=t('<div class="spinner hidden">').appendTo(this.$leftButtons),this.$deleteBtn=t('<div class="btn delete hidden" role="button">').text(Craft.t("sprout-forms","Delete")).appendTo(this.$leftButtons),this.$cancelBtn=t('<div class="btn disabled" role="button">').text(Craft.t("sprout-forms","Cancel")).appendTo(this.$rightButtons),this.$saveBtn=t('<div class="btn submit disabled" role="button">').text(Craft.t("sprout-forms","Save")).appendTo(this.$rightButtons),this.$saveSpinner=t('<div class="spinner hidden">').appendTo(this.$rightButtons),this.setContainer(s),this.$loadSpinner.addClass("hidden");this.initTemplate({html:"",js:"",css:""})},initTemplate:function(e){var i=t.proxy((function(t){this.$html=t.$html,this.$js=t.$js,this.$css=t.$css,this.templateLoaded=!0,this.initListeners(),this.visible&&this.initSettings(),this.off("parseTemplate",i)}),this);this.on("parseTemplate",i),this.parseTemplate(e)},parseTemplate:function(e){var i=this,s=Garnish.$doc.find("head"),n=t(e.html),r=t(e.js).filter("script"),a=t(e.css).filter("style, link"),o=a.filter("link").prop("async",!0),l=a.filter("style");o.each((function(){var e=t(this),n=e.prop("href");i.loadedCss.hasOwnProperty(n)||(s.append(e),i.loadedCss[n]=e)}));var d=r.filter("[src]"),u=r.filter(":not([src])"),c=[];d.each((function(){var e=t(this).prop("src");i.executedJs.hasOwnProperty(e)||(c.push(e),i.executedJs[e]=!0)}));t.when(this.runExternalScripts(c)).then(function t(){i.off("runExternalScripts",t),i.trigger("parseTemplate",{target:this,$html:n,$js:u,$css:l})}()),this.$deleteBtn.removeClass("hidden"),this.$saveBtn.removeClass("disabled"),this.$cancelBtn.removeClass("disabled")},runExternalScripts:function(e){var i=e.length;if(i>0)for(var s=0;s<e.length;s++){var n=e[s];(n.indexOf("MatrixConfigurator")>=0||n.indexOf("TableFieldSettings.min.js")>=0||n.indexOf("quill.min.js")>=0||n.indexOf("sproutfields.js")>=0||n.indexOf("EditableTable.js")>=0||n.indexOf("initialize.js")>=0)&&t.getScript(n,t.proxy((function(t,e){"success"===e?0===--i&&this.trigger("runExternalScripts",{target:this}):Craft.cp.displayError(Craft.t("sprout-forms","Could not load all resources."))}),this))}else this.trigger("runExternalScripts",{target:this})},initListeners:function(){this.$deleteBtn.addClass("hidden"),this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.addListener(this.$cancelBtn,"activate","closeModal"),this.addListener(this.$saveBtn,"activate","saveRule"),this.addedDelete||(this.addListener(this.$deleteBtn,"click","deleteRule"),this.addedDelete=!0),this.on("show",this.initSettings),this.on("fadeOut",this.destroySettings),this.enable()},destroyListeners:function(){this.$cancelBtn.addClass("disabled"),this.$saveBtn.addClass("disabled"),this.removeListener(this.$cancelBtn,"activate"),this.removeListener(this.$saveBtn,"activate"),this.off("show",this.initSettings),this.off("fadeOut",this.destroySettings),this.disable()},initSettings:function(e){var i=e&&e.target?e.target:this;if(i.templateLoaded){i.$currentHtml=e&&e.$html?e.$html:i.$html.clone(),i.$currentJs=e&&e.$js?e.$js:i.$js.clone(),i.$currentCss=e&&e.$css?e.$css:i.$css.clone(),i.$observed=t(),i.observer.observe(Garnish.$bod[0],{childList:!0,subtree:!1}),i.$main.append(i.$currentHtml),Garnish.$bod.append(i.$currentJs),Craft.initUiElements();t.when(i.runExternalScripts(Object.keys(i.executedJs))).then(function t(){i.off("runExternalScripts",t),setTimeout((function(){i.observer.disconnect()}),1)}())}},destroySettings:function(t){var e=t&&t.target?t.target:this;e.$currentHtml.remove(),e.$currentJs.remove(),e.$currentCss.remove(),e.$observed.remove()},closeModal:function(){this.hide()},saveRule:function(e){if(e&&e.preventDefault(),!this.$saveBtn.hasClass("disabled")&&this.$saveSpinner.hasClass("hidden")){this.destroyListeners(),this.$saveSpinner.removeClass("hidden");var i=this.$container.serialize(),s=this.$container.find('input[name="ruleId"]');!!s.length&&s.val();Craft.postActionRequest("sprout-forms/rules/save-rule",i,t.proxy((function(e,i){this.$saveSpinner.addClass("hidden");var s="success"===i;if(s&&e.success)this.initListeners(),this.trigger("saveRule",{target:this,rule:e.rule}),Craft.cp.displayNotice(Craft.t("sprout-forms","'{name}' rule saved.",{name:e.rule.name})),this.hide();else if(s&&e.template)if(this.visible){var n=t.proxy((function(t){this.initListeners(),this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template),Garnish.shake(this.$container)}else this.initListeners();else this.initListeners(),Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred."))}),this))}},editRule:function(e){this.destroyListeners(),this.show(),this.initListeners(),this.$loadSpinner.removeClass("hidden");var i={ruleId:e,formId:t("#formId").val()};Craft.postActionRequest("sprout-forms/rules/edit-rule",i,t.proxy((function(e,i){this.$loadSpinner.addClass("hidden");var s="success"===i;if(s&&e.success){var n=t.proxy((function(t){this.destroySettings(),this.initSettings(t),this.off("parseTemplate",n)}),this);this.on("parseTemplate",n),this.parseTemplate(e.template)}else s&&e.error?(Craft.cp.displayError(e.error),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","An unknown error occurred. ")),this.hide())}),this))},deleteRule:function(e){if(e.preventDefault(),this.confirmDeleteRule()){this.destroyListeners();var i=this.$container.serialize(),s=t(this.$container).find('input[name="ruleId"]').val();Craft.postActionRequest("sprout-forms/rules/delete-rule",i,t.proxy((function(e,i){"success"===i&&e.success?(Craft.cp.displayNotice(Craft.t("sprout-forms","Rule deleted.")),t("#sproutforms-rules-row-"+s).remove(),this.initListeners(),this.hide()):(Craft.cp.displayError(Craft.t("sprout-forms","Unable to delete rule.")),this.hide())}),this))}},confirmDeleteRule:function(){return confirm("Are you sure you want to delete this rule and all of it's settings?")},hide:function(){this._disabled||this.base()},destroy:function(){this.base.destroy(),this.destroyListeners(),this.destroySettings(),this.$shade.remove(),this.$container.remove(),this.trigger("destroy")}},{getInstance:function(){return this._instance||(this._instance=new Craft.SproutForms.RuleModal),this._instance}})}(jQuery)},,,,,,,,,function(t,e){},,,,,function(t,e){},,function(t,e){}]);